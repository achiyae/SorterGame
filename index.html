<!DOCTYPE html>
<html>
<head>
    <title>Sorting game</title>
    <style>
        .container {
            border: black solid 2px;
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: flex-end;
            height: 300px;
            background-color: #f2f2f2;
            padding: 20px;
        }

        .bowel {
            bottom: 10px;
            border-left: black solid 2px;
            border-right: black solid 2px;
            border-bottom: black solid 2px;
            width: 300px;
            height: 100px;
            display: flex;
            flex-shrink: 0;
            justify-content: space-between;
        }

        .pile {
            bottom: 10px;
            border-left: black solid 2px;
            border-right: black solid 2px;
            border-bottom: black solid 2px;
            width: 20px;
            height: 70px;
            display: flex;
            flex-direction: column-reverse;
            align-items: center;
        }

        .pile-block {
            width: 10px;
            height: 10px;
            margin-bottom: 1px;
            flex-shrink: 0;
        }

        .counter {
            position: absolute;
            top: 328px;
            width: inherit;
            text-align: center;
            font-size: 20px;
            flex-shrink: 0;
        }

        #robot {
            position: relative;
            top: -40px;
            left: 50%;
            transition: transform 1s;
        }

        #robotic-arm {
            width: 10px;
            height: 30px;
            background-color: gray;
        }

        button {
            color: white;
            /*border: none;*/
            margin: 10px;
            font-size: 31px;
            height: 30px;
            width: 30px;
            box-shadow: 0 2px 4px darkslategray;
            cursor: pointer;
            transition: all 0.2s ease;
            border-radius: 70%;
        }

        button:active {
            box-shadow: 0 0 2px darkslategray;
            transform: translateY(2px);
        }

        button:not(:first-child) {
            margin-top: 10px;
        }

        .block {
            width: 10px;
            height: 10px;
            margin-top: 88px;
            margin-left: 1px;
            margin-right: 1px;
        }

        #robot .block {
            margin-top: 1px;
            margin-left: -1px;
        }

        .transparent {
            background-color: transparent;
        }

        .red {
            background-color: red;
            border: black solid 1px;
        }

        .red-b {
            border-color: red;
        }

        .green {
            background-color: green;
            border: black solid 1px;
        }

        .green-b {
            border-color: green;
        }

        .blue {
            background-color: blue;
            border: black solid 1px;
        }

        .blue-b {
            border-color: blue;
        }

        .side-panel {
            width: 130px;
            height: 110px;
            align-items: center;
            padding: 20px;
            background-color: #f2f2f2;
            border: black solid 2px;
        }

        .side-panel h2 {
            margin: 0 0 10px;
        }

        .side-panel p {
            margin: 0;
            font-size: 16px;
        }
    </style>
</head>
<body>
<div class="container">
    <button class="green" onclick="move('green')"></button>
    <button class="blue" onclick="move('blue')"></button>
    <button class="red" onclick="move('red')"></button>
    <div class="bowel">
        <div id="robot">
            <div id="robotic-arm"></div>
            <div id="robot-block" class="block transparent"></div>
        </div>
        <div class="block green"></div>
        <div class="block blue"></div>
        <div class="block red"></div>
        <div class="block green"></div>
        <div class="block red"></div>
        <div class="block red"></div>
        <div class="block blue"></div>
        <div class="block red"></div>
        <div class="block green"></div>
        <div class="block green"></div>
        <div class="block blue"></div>
        <div class="block blue"></div>
        <div class="block red"></div>
        <div class="block blue"></div>
    </div>
    <div style="width: 20px;"></div>
    <div class="pile red-b">
        <div class="pile-block transparent"></div>
        <div class="pile-block transparent"></div>
        <div class="pile-block transparent"></div>
        <div class="pile-block transparent"></div>
        <div class="pile-block transparent"></div>
        <div id="red-counter" class="counter">0</div>
    </div>
    <div style="width: 20px;"></div>
    <div class="pile blue-b">
        <div class="pile-block transparent"></div>
        <div class="pile-block transparent"></div>
        <div class="pile-block transparent"></div>
        <div class="pile-block transparent"></div>
        <div class="pile-block transparent"></div>
        <div id="blue-counter" class="counter">0</div>
    </div>
    <div style="width: 20px;"></div>
    <div class="pile green-b">
        <div class="pile-block transparent"></div>
        <div class="pile-block transparent"></div>
        <div class="pile-block transparent"></div>
        <div class="pile-block transparent"></div>
        <div class="pile-block transparent"></div>
        <div id="green-counter" class="counter">0</div>
    </div>
</div>
<div class="container" style="height: 150px; border: transparent; background: transparent">
    <div class="side-panel">
        <h2>Actuators</h2>
        <table>
            <tr>
                <td>Magnet:</td>
                <td><p style="background: transparent; border: black solid 1px; text-align: center">Off</p></td>
            </tr>
            <tr>
                <td>H-Motor:</td>
                <td><span>0</span> cm/sec</td>
            </tr>
            <tr>
                <td>V-Motor:</td>
                <td><span>0</span> cm/sec</td>
            </tr>
        </table>
    </div>
    <div style="width: 20px;"></div>
    <div class="side-panel">
        <h2>Sensors</h2>
        <table>
            <tr>
                <td>Color:</td>
                <td><p class="block red"></p></td>
            </tr>
        </table>
    </div>
    <div style="width: 20px;"></div>
    <div class="side-panel">
        <h2>Debug</h2>
        <table>
            <tr>
                <td>Location X:</td>
                <td id="robot-value-x">-</td>
            </tr>
            <tr>
                <td>Location Y:</td>
                <td id="robot-value-y">-</td>
            </tr>
        </table>
    </div>
</div>
<script>
  function move(color) {
    var robot = document.getElementById('robot')
    var robotBlock = document.getElementById('robot-block')
    var blocks = document.getElementsByClassName('block ' + color)
    var coloredPile = document.getElementsByClassName('pile ' + color + '-b')[0]
    var counter = document.getElementById(color + '-counter')
    var lastTransparentBlock = coloredPile.querySelectorAll('.pile-block.transparent')[0]
    var count = parseInt(counter.innerHTML)

    if (blocks.length > 0) {
      var firstBlock = blocks[0]
      var blockLeft = firstBlock.offsetLeft - robot.offsetLeft
      var blockTop = firstBlock.offsetTop - robot.offsetTop - 30
      var pileLeft = coloredPile.offsetLeft - robot.offsetLeft + 7
      var pileTop = lastTransparentBlock.offsetTop - robot.offsetTop - 32 - 1 * count

      robot.style.transform = 'translateX(' + blockLeft + 'px)'
      setTimeout(function () {
        robot.style.transform = 'translate(' + blockLeft + 'px, ' + blockTop + 'px)'
        setTimeout(function () {
          firstBlock.className = 'block transparent'
          robotBlock.className = 'block ' + color
          robot.style.transform = 'translate(' + blockLeft + 'px, 0px)'
          setTimeout(function () {
            robot.style.transform = 'translate(' + pileLeft + 'px, 0px)'
            setTimeout(function () {
              robot.style.transform = 'translate(' + pileLeft + 'px, ' + pileTop + 'px)'
              setTimeout(function () {
                robot.style.transform = 'translate(' + pileLeft + 'px, 0)'
                setTimeout(function () {
                  robot.style.transform = 'translate(0,0)'
                }, 1000)
                robotBlock.className = 'block transparent'
                lastTransparentBlock.className = 'pile-block ' + color
                count++
                counter.innerHTML = count.toString()
              }, 1000)
            }, 1000)
          }, 1000)
        }, 1000)
      }, 1000)
    } else {
      robot.style.transform = 'translateX(-700px)'
    }
  }
</script>
<script>
  var robot = document.getElementById('robot')
  var initRobotPosition = getOffset(robot)
  var robotValueX = document.getElementById('robot-value-x')
  var robotValueY = document.getElementById('robot-value-y')

  function updateRobotLocation(style) {
    var x = style.left - initRobotPosition.left
    var y = style.top - initRobotPosition.top
    robotValueX.textContent = x + ''
    robotValueY.textContent = y + ''
  }

  var observer = new MutationObserver(function (mutations) {
    mutations.forEach(function (m) {
        console.log(m.attributeName +
            " -- old:" + m.oldValue +
            ", new: " + m.target.getAttribute(m.attributeName));
      updateRobotLocation(m.target.getAttribute(m.attributeName))
    })
  })

  function getOffset(el) {
    const rect = el.getBoundingClientRect()
    return {
      left: Math.round(rect.left + window.scrollX),
      top: Math.round(rect.top + window.scrollY)
    }
  }


  observer.observe(robot, { attributes: true, attributeFilter: ['offsetLeft, offsetTop'], attributeOldValue: true })
</script>
</body>
</html>
